(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b16af"],{2083:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.dialogVisible?i("el-dialog",{attrs:{title:t.dialogTitle,"append-to-body":"",width:"80%",top:"10vh",visible:t.dialogVisible},on:{close:t.closeDialog,"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"ph-form",staticStyle:{"margin-top":"15px"}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"detailItem",attrs:{rules:t.rules,model:t.detailItem,"status-icon":"",inline:"","label-position":"right","label-width":"120px"}},[i("el-row",[i("el-col",{attrs:{md:10}},[i("el-form-item",{attrs:{label:"供货商"}},[i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.order.supplier.name))])])],1),t._v(" "),i("el-col",{attrs:{md:14}},[i("el-form-item",{attrs:{label:"结算货币"}},[i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.order.currency.name))])])],1)],1),t._v(" "),i("el-row",[i("el-col",{attrs:{md:10}},[i("el-form-item",{attrs:{label:"SKU",prop:"skuCode"}},[this.detailItemId?i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.detailItem.skuCode))]):i("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"50","show-word-limit":"",placeholder:"请填写SKU",clearable:""},model:{value:t.detailItem.skuCode,callback:function(e){t.$set(t.detailItem,"skuCode","string"===typeof e?e.trim():e)},expression:"detailItem.skuCode"}}),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"输入产品SKU编码",placement:"right"}},[i("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),i("el-col",{attrs:{md:14}},[i("el-form-item",{attrs:{label:"采购单价",prop:"price"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请填写采购单价",clearable:""},model:{value:t.detailItem.price,callback:function(e){t.$set(t.detailItem,"price","string"===typeof e?e.trim():e)},expression:"detailItem.price"}}),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"产品的采购价格。",placement:"right"}},[i("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1)],1),t._v(" "),i("el-row",[i("el-col",{attrs:{md:10}},[i("el-form-item",{attrs:{label:"箱规",prop:"cartonSpecId"}},[i("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"外箱包装材料规格,可筛选"},model:{value:t.detailItem.cartonSpecId,callback:function(e){t.$set(t.detailItem,"cartonSpecId",e)},expression:"detailItem.cartonSpecId"}},t._l(t.cartonspecSelectOptions,function(t,e){return i("el-option",{key:e,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"产品外箱包装材料规格。不输入使用产品上默认的箱规",placement:"right"}},[i("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),i("el-col",{attrs:{md:14}},[i("el-form-item",{attrs:{label:"装箱数",prop:"numberOfCarton"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请填写装箱数",clearable:""},model:{value:t.detailItem.numberOfCarton,callback:function(e){t.$set(t.detailItem,"numberOfCarton","string"===typeof e?e.trim():e)},expression:"detailItem.numberOfCarton"}}),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"一箱有多少个产品.不输入使用产品上默认的装箱数",placement:"right"}},[i("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1)],1),t._v(" "),i("el-row",[i("el-col",{attrs:{md:10}},[i("el-form-item",{attrs:{label:"采购箱数",prop:"purchaseOrderCartonQty"}},[i("el-input-number",{staticStyle:{width:"200px"},attrs:{size:"small",precision:3,min:1,step:1,max:1e6,label:"采购箱数"},model:{value:t.detailItem.cartonQty,callback:function(e){t.$set(t.detailItem,"cartonQty",e)},expression:"detailItem.cartonQty"}}),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"采购箱数,支持3位小树。",placement:"right"}},[i("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),i("el-col",{attrs:{md:10}},[i("el-form-item",{attrs:{label:"采购件数"}},[i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.orderQty))])])],1)],1),t._v(" "),i("hr"),t._v(" "),i("el-row",{staticStyle:{"text-align":"right","font-size":"13px","font-weight":"bold"}},[t._v("\n        总额: "+t._s(t._f("currency")(t.amount,t.order.currency.symbolLeft))+"\n      ")])],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"warning",loading:t.confirmLoading},on:{click:t.onLoadProduct}},[t._v("获取产品默认信息")]),t._v(" "),i("el-button",{attrs:{type:"primary",loading:t.confirmLoading},on:{click:t.onSave}},[t._v("保 存")]),t._v(" "),i("el-button",{on:{click:t.closeDialog}},[t._v("取 消")])],1)]):t._e()},l=[],o=i("d186"),n=i("b99d"),r=i("ed08"),s={components:{},props:{primary:{type:[Object],default:null}},filters:{currency:r["b"]},computed:{orderQty:function(){return this.calOrderQty()},amount:function(){return this.calAmount()},dialogTitle:function(){return null==this.detailItemId?"添加采购单明细":"修改采购单明细"},hasEdit:function(){return!([0,8].indexOf(this.primary.status)>-1)}},data:function(){return{dialogVisible:!1,loading:!1,confirmLoading:!1,url:"/procurementOrderItems",relations:["product"],detailItemId:null,detailItem:{},order:{},cartonspecSelectOptions:[],rules:{skuCode:[n["a"].required],cartonQty:[n["a"].required],cartonSpecId:[n["a"].required],numberOfCarton:[n["a"].required,n["a"].integer],price:[n["a"].required,n["a"].number]}}},created:function(){},mounted:function(){this.$nextTick(function(){})},methods:{initData:function(){var t=this;if(this.cartonspecSelectOptions=o["a"].getSelectOptions(),this.detailItemId){this.loading=!0;var e="".concat(this.url,"/").concat(this.detailItemId);this.relations&&this.relations.length>0&&(e+="?relations="+JSON.stringify(this.relations)),this.global.axios.get(e).then(function(e){var i=e.data,a=i||{};t.detailItem=a,t.detailItem.cartonSpecId=a.cartonSpecId+"",t.skuCode=a.product.skuCode,t.loading=!1})}else this.detailItem={skuCode:"",price:null,cartonSpecId:null,cartonQty:0,qty:0,numberOfCarton:null,amount:null}},openDialog:function(t,e){this.detailItemId=t,this.order=e,this.dialogVisible=!0,this.initData()},closeDialog:function(){this.dialogVisible=!1,this.loading=!1,this.confirmLoading=!1,this.detailItemId=null,this.detailItem=null,this.order=null,this.cartonspecSelectOptions=[]},calOrderQty:function(){return(this.detailItem.cartonQty*this.detailItem.numberOfCarton).toFixed(0)},calAmount:function(){return(this.detailItem.price*this.calOrderQty()).toFixed(2)},onLoadProduct:function(){var t=this;if(this.detailItem.skuCode){this.loading=!0,this.confirmLoading=!0;var e="/products/sku/".concat(this.detailItem.skuCode);this.global.axios.get(e).then(function(e){var i=e.data,a=i||{};t.detailItem.price=a.price,t.detailItem.cartonSpecId=a.cartonSpecId+"",t.detailItem.numberOfCarton=a.numberOfCarton,t.confirmLoading=!1,t.loading=!1}).catch(function(e){t.loading=!1,t.confirmLoading=!1})}else this.$message.error("请输入产品SKU")},onSave:function(){var t=this;this.$refs.detailItem.validate(function(e){if(!e)return!1;t.loading=!0,t.confirmLoading=!0;var i="post",a=t.url+"";!t.detailItemId&&t.detailItemId>0&&(i="put",a="".concat(t.url,"/").concat(t.detailItemId));var l=JSON.parse(JSON.stringify(t.detailItem));l.procurementOrderId||(l.procurementOrderId=t.order.id),t.global.axios[i](a,l).then(function(e){t.$message.info("修改成功"),t.loading=!1,t.confirmLoading=!1,t.dialogVisible=!1,t.$emit("modifyCBEvent",e.data)}).catch(function(e){t.loading=!1,t.confirmLoading=!1})})}}},c=s,d=i("2877"),m=Object(d["a"])(c,a,l,!1,null,"e83e043c",null);e["default"]=m.exports}}]);