(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bbeb4fae","chunk-462c9398"],{2843:function(e,t,a){"use strict";var l=a("6d74"),i=a.n(l);i.a},"38e8":function(e,t,a){"use strict";var l=a("cceb"),i=a.n(l);i.a},"4fbb":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"smart",attrs:{rules:e.rules,model:e.newObject,"status-icon":"",inline:"","label-position":"right","label-width":"120px"}},[a("fieldset",{staticClass:"panel-heading"},[a("legend",{staticClass:"panel-title"},[e._v("智能备货\n        "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"right"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n            智能备货是通过销量情况、各地库存情况自动推荐备货数量。需要选择以下对应的选项。"),a("BR"),e._v("\n            公式：((7日销量 x ️备货周数) - 亚马逊库存(含在途) - 国内库存 - 未完成采购计划数(根据选项处理)) ➗ 装箱数（自动四舍五入保证整箱）\n          ")],1),e._v(" "),a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{md:10}},[a("el-form-item",{attrs:{label:"销售渠道",prop:"merchantId"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",placeholder:"请选择销售渠道"},model:{value:e.newObject.merchantId,callback:function(t){e.$set(e.newObject,"merchantId",t)},expression:"newObject.merchantId"}},e._l(e.merchantSelectOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"以选定的销售渠道（销售店铺）的销售情况为备货依据。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1),e._v(" "),a("el-col",{attrs:{md:14}},[a("el-form-item",{attrs:{label:"标签",prop:"tags"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{maxlength:"20","show-word-limit":"",placeholder:"请填写标签",clearable:""},model:{value:e.newObject.tags,callback:function(t){e.$set(e.newObject,"tags",t)},expression:"newObject.tags"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"给计划打上一个标签方便查找",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{md:10}},[a("el-form-item",{attrs:{label:"分类",prop:"categoryId"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",multiple:"",placeholder:"请选择分类,可多选"},model:{value:e.newObject.categoryId,callback:function(t){e.$set(e.newObject,"categoryId",t)},expression:"newObject.categoryId"}},e._l(e.categorySelectOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"选择需要备货的分类",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1),e._v(" "),a("el-col",{attrs:{md:14}},[a("el-form-item",{attrs:{label:"国内库存",prop:"warehouseId"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",multiple:"",placeholder:"请选择库存,可多选"},model:{value:e.newObject.warehouseId,callback:function(t){e.$set(e.newObject,"warehouseId",t)},expression:"newObject.warehouseId"}},e._l(e.warehouseSelectOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"以选定的仓库库存情况为当前库存依据。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{md:10}},[a("el-form-item",{attrs:{label:"下单截止日",prop:"limitTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"date",placeholder:"下单截止日"},model:{value:e.newObject.limitTime,callback:function(t){e.$set(e.newObject,"limitTime",t)},expression:"newObject.limitTime"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"本次采购必须在这个日期之前完成交货",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1),e._v(" "),a("el-col",{attrs:{md:14}},[a("el-form-item",{attrs:{label:"交货截止日",prop:"executeTime"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"date",placeholder:"交货截止日"},model:{value:e.newObject.executeTime,callback:function(t){e.$set(e.newObject,"executeTime",t)},expression:"newObject.executeTime"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"本次采购必须在这个日期之前向厂家签好采购合同",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{md:10}},[a("el-form-item",{attrs:{label:"非Vip备货周数",prop:"safetyStockWeek"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",placeholder:"请选择非Vip备货周数"},model:{value:e.newObject.safetyStockWeek,callback:function(t){e.$set(e.newObject,"safetyStockWeek",t)},expression:"newObject.safetyStockWeek"}},e._l(52,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"普通类型的产品，希望支持销售的周数。可在产品管理中查看产品类型。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1),e._v(" "),a("el-col",{attrs:{md:14}},[a("el-form-item",{attrs:{label:"Vip1备货周数",prop:"vip1SafetyStockWeek"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",placeholder:"请选择Vip1备货周数"},model:{value:e.newObject.vip1SafetyStockWeek,callback:function(t){e.$set(e.newObject,"vip1SafetyStockWeek",t)},expression:"newObject.vip1SafetyStockWeek"}},e._l(52,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"热卖类型的产品，希望支持销售的周数。可在产品管理中查看产品类型。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{md:10}},[a("el-form-item",{attrs:{label:"Vip2备货周数",prop:"vip2SafetyStockWeek"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",placeholder:"请选择Vip2备货周数"},model:{value:e.newObject.vip2SafetyStockWeek,callback:function(t){e.$set(e.newObject,"vip2SafetyStockWeek",t)},expression:"newObject.vip2SafetyStockWeek"}},e._l(52,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"爆款类型的产品，希望支持销售的周数。可在产品管理中查看产品类型。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1),e._v(" "),a("el-col",{attrs:{md:14}},[a("el-form-item",{attrs:{label:"未完成采购计划处理方式",prop:"handleMethod"}},[a("el-select",{staticStyle:{width:"220px"},attrs:{filterable:"",placeholder:"请选择未完成采购计划处理方式"},model:{value:e.newObject.handleMethod,callback:function(t){e.$set(e.newObject,"handleMethod",t)},expression:"newObject.handleMethod"}},[a("el-option",{attrs:{label:"不考虑",value:"0"}}),e._v(" "),a("el-option",{attrs:{label:"采购计划数量",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"已下采购单数量",value:"2"}}),e._v(" "),a("el-option",{attrs:{label:"已发货数量",value:"3"}}),e._v(" "),a("el-option",{attrs:{label:"已收货数量",value:"4"}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"right"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("对当前没有结束的其它采购计划的处理方式。"),a("BR"),e._v("\n                例如：选择已发货数量。表示最终需要减去没有完成采购计划中，已经发货的数量。"),a("BR"),e._v("\n                具体各种状态数量可以在采购计划中查看。\n              ")],1),e._v(" "),a("i",{staticClass:"el-icon-question"},[e._v(" ")])])],1)],1)],1),e._v(" "),a("el-col",{attrs:{md:24}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.onSmart}},[e._v("\n            智能备货\n          ")])],1)],1)],1)]),e._v(" "),a("itemTable",{ref:"itemTable",on:{createCBEvent:e.createCBEvent}})],1)},i=[],n=(a("ac6a"),a("c405")),o=a("64dc"),r=a("8492"),s=a("8593"),c=(a("ed08"),a("e804")),u={components:{itemTable:c["default"]},props:{},computed:{},data:function(){return{loading:!1,confirmLoading:!1,categorySelectOptions:[],warehouseSelectOptions:[],merchantSelectOptions:[],newObject:{id:null,categoryId:null,limitTime:null,executeTime:null,tags:null,note:null,merchantId:null,warehouseId:null,handleMethod:"3",safetyStockWeek:null,vip1SafetyStockWeek:null,vip2SafetyStockWeek:null},rules:{limitTime:[{required:!0,message:"必须输入",trigger:"blur"}],executeTime:[{required:!0,message:"必须输入",trigger:"blur"}],categoryId:[{required:!0,message:"必须输入",trigger:"blur"}],merchantId:[{required:!0,message:"必须输入",trigger:"blur"}],warehouseId:[{required:!0,message:"必须输入",trigger:"blur"}],safetyStockWeek:[{required:!0,message:"必须输入",trigger:"blur"}],vip1SafetyStockWeek:[{required:!0,message:"必须输入",trigger:"blur"}],vip2SafetyStockWeek:[{required:!0,message:"必须输入",trigger:"blur"}],handleMethod:[{required:!0,message:"必须输入",trigger:"blur"}]}}},mounted:function(){var e=this;this.$nextTick(function(){e.initData()})},methods:{initData:function(){var e=this;this.loading=!0,this.categorySelectOptions=n["a"].getMineSelectOptions(),this.merchantSelectOptions=r["a"].getSelectOptions(),this.warehouseSelectOptions=o["a"].getSelectDomesticOptions(),s["a"].getConfigInfos().then(function(t){null==e.newObject.safetyStockWeek&&(e.newObject.safetyStockWeek=t.safetyStockWeek),null==e.newObject.vip1SafetyStockWeek&&(e.newObject.vip1SafetyStockWeek=t.vip1SafetyStockWeek),null==e.newObject.vip2SafetyStockWeek&&(e.newObject.vip2SafetyStockWeek=t.vip2SafetyStockWeek)});var t=!0;this.warehouseSelectOptions.forEach(function(e){"-99"==e.value&&(t=!1)}),t&&this.warehouseSelectOptions.unshift({label:"供货商库存",value:"-99"}),this.loading=!1},onSmart:function(){var e=this;this.$refs.smart.validate(function(t){t&&(e.confirmLoading=!0,e.$refs.itemTable.openDialog(e.newObject),e.confirmLoading=!1)})},createCBEvent:function(e){this.$emit("smartCBEvent",e)}}},d=u,m=(a("38e8"),a("2877")),p=Object(m["a"])(d,l,i,!1,null,"466a1c8f",null);t["default"]=p.exports},"6d74":function(e,t,a){},cceb:function(e,t,a){},e804:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.dialogVisible?a("el-dialog",{attrs:{title:"智能备货",visible:e.dialogVisible,fullscreen:""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchParam,id:"filter-form"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"SKU"}},[a("el-input",{attrs:{placeholder:"请输入SKU",clearable:""},model:{value:e.searchParam.skuCode,callback:function(t){e.$set(e.searchParam,"skuCode",t)},expression:"searchParam.skuCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分类"}},[a("el-input",{attrs:{placeholder:"请输入分类名称",clearable:""},model:{value:e.searchParam.category,callback:function(t){e.$set(e.searchParam,"category",t)},expression:"searchParam.category"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{"native-type":"submit",type:"primary",size:"small"},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1),e._v(" "),a("div",{staticClass:"ph-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{stripe:"",border:"","highlight-current-row":"","max-height":e.tableMaxHeight,"row-class-name":e.dangerClassName,"cell-style":{padding:"2px 0","font-size":"13px"},"header-cell-style":{padding:"2px 0"},data:e.tableData,"show-summary":"","summary-method":e.getSummaries,"default-sort":{prop:"replenishmentCartonPlanQty",order:"descending"},id:"table"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"skuCode",label:"SKU",sortable:"",width:"200",fixed:"left"}}),e._v(" "),a("el-table-column",{attrs:{prop:"categoryName",label:"分类",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"numberOfCarton",label:"装箱数",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"safetyWeek",label:"备货周数",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"demandedCartonQty",sortable:"",label:"需求总量(箱)",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sevenAmendQty",sortable:"",label:"7日销量(件)",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"totalQty",sortable:"",label:"亚马逊含在途库存(件)",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"domesticStockCartonQty",sortable:"",label:"国内库存(箱)",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unfinishedPlanCartonQty",sortable:"",label:"国内在途(箱)",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"productName",label:"名称",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"fnSku",label:"FNSKU","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"vipLevel",label:"Vip级别",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cartonSpecCode",label:"箱规",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"numberOfPallets",label:"托盘装箱数",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"saleWeek",sortable:"",label:"可售周数",width:"120",fixed:"right"}}),e._v(" "),a("el-table-column",{attrs:{prop:"replenishmentCartonPlanQty",sortable:"",label:"采购箱数",width:"120",fixed:"right"}}),e._v(" "),e.hasOperation?a("el-table-column",{attrs:{label:"操作",width:"50",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasDelete?a("el-button",{attrs:{type:"danger",size:"mini",id:"ph-table-del",icon:"el-icon-delete",circle:""},on:{click:function(a){return e.onDefaultDelete(t.row)}}}):e._e()]}}],null,!1,2340255448)}):e._e()],1),e._v(" "),a("el-col",{attrs:{md:24}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.onCreateObject}},[e._v("\n          生成采购计划\n        ")])],1)],1)],1)],1):e._e()},i=[],n=(a("c5f6"),a("386d"),a("ac6a"),a("cebc")),o=a("2f62"),r={components:{},props:{},computed:Object(n["a"])({},Object(o["b"])(["device"])),data:function(){return{tableMaxHeight:"mobile"!==this.device?400:4e7,dialogVisible:!1,confirmLoading:!1,hasOperation:!0,hasDelete:!0,selected:[],object:null,url:null,searchParam:{skuCode:null,category:null},relations:[],data:[],tableData:[],loading:!1,row:{}}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){e.getTableHeight(),e.initData(),e.getList()})},methods:{initData:function(){},getTableHeight:function(){if("mobile"!==this.device){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=e;t-=200,this.tableMaxHeight=t}else this.tableMaxHeight=400},openDialog:function(e){this.dialogVisible=!0,this.object=e,this.url="/amazonStocks/plans/".concat(e.merchantId,"?warehouse=").concat(e.warehouseId.join(","),"&category=").concat(e.categoryId.join(","),"&safetyStockWeek=").concat(e.safetyStockWeek,"&vip1SafetyStockWeek=").concat(e.vip1SafetyStockWeek,"&vip2SafetyStockWeek=").concat(e.vip2SafetyStockWeek,"&exclude=").concat(e.handleMethod),this.getTableHeight(),this.initData(),this.getList()},dangerClassName:function(e){e.row;return""},onDefaultDelete:function(e){var t=this;this.$confirm("确认删除吗","提示",{type:"warning",beforeClose:function(a,l,i){if("confirm"==a){var n=null;t.data.forEach(function(t,a){t.skuCode!==e.skuCode||(n=a)}),t.date=t.data.splice(n,1),t.search(),i()}else i()}}).catch(function(e){})},getSummaries:function(e){var t=e.columns,a=e.data,l=[];return t.forEach(function(e,t){if(0!==t){if("replenishmentCartonPlanQty"==e.property){var i=a.map(function(t){return Number(t[e.property])});i.every(function(e){return isNaN(e)})?l[t]="N/A":(l[t]=i.reduce(function(e,t){var a=Number(t);return isNaN(a)?e:e+t},0),l[t]+=" 箱")}if("skuCode"==e.property){var n=a.map(function(t){return t[e.property]});l[t]=n.reduce(function(e){return e+1},0),l[t]+=" 行"}}else l[t]="合计"}),l},getList:function(){var e=this,t=this.url;t&&(t.indexOf("?")>-1?t+="&":t+="?",this.relations&&this.relations.length>0&&(params+="&relations="+JSON.stringify(this.relations)),this.loading=!0,this.global.axios.get(t).then(function(t){var a=t.data,l=a||[];e.data=l,e.search(),e.loading=!1,e.$emit("update",l,a)}).catch(function(t){e.$emit("error",t),e.loading=!1}))},handleSelectionChange:function(e){this.selected=e},onCreateObject:function(){var e=this;null==this.selected||0==this.selected.length?this.$confirm("您没有选择任何推荐备货的商品，如果您确认。将手工维护采购计划明细，是否继续？","提示",{type:"warning",beforeClose:function(t,a,l){"confirm"==t?(l(),e.createObject()):l()}}).catch(function(e){}):this.createObject()},createObject:function(){var e=this;this.loading=!0,this.confirmLoading=!0;var t=JSON.parse(JSON.stringify(this.object));t.warehouseId=t.warehouseId?t.warehouseId.join(","):"";var a=[];this.selected.forEach(function(e){e.safetyStockWeek=e.safetyWeek,e.cartonQty=e.replenishmentCartonPlanQty,e.sevenSalesCount=e.sevenAmendQty,e.amazonTotalStock=e.totalQty,a.push(e)}),t.planItems=JSON.parse(JSON.stringify(a)),this.global.axios.post("/procurementPlans",t).then(function(t){var a=t.data;e.$message({type:"success",message:"操作成功"}),e.loading=!1,e.confirmLoading=!1,e.dialogVisible=!1,e.$emit("createCBEvent",a.id)}).catch(function(t){e.loading=!1,e.confirmLoading=!1})},search:function(){var e=this;this.tableData=this.data,null!=this.searchParam.category&&""!=this.searchParam.category&&(this.tableData=this.tableData.filter(function(t){if(t.categoryName&&-1!==t.categoryName.indexOf(e.searchParam.category))return!0})),null!=this.searchParam.skuCode&&""!=this.searchParam.skuCode&&(this.tableData=this.tableData.filter(function(t){if(-1!==t.skuCode.indexOf(e.searchParam.skuCode))return!0}))},resetSearch:function(){this.$refs.searchForm.resetFields(),this.searchParam.skuCode=null,this.searchParam.category=null,this.search()}}},s=r,c=(a("2843"),a("2877")),u=Object(c["a"])(s,l,i,!1,null,"d02e6cd2",null);t["default"]=u.exports}}]);