(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09d3b35c","chunk-39fb2254","chunk-2cb0220d"],{"0257":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"ph-card"},[a("div",{staticClass:"ph-card-body"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleTabClick},model:{value:e.activeStatus,callback:function(t){e.activeStatus=t},expression:"activeStatus"}},[a("el-tab-pane",{attrs:{name:"create",lazy:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 待下单\n          ")]),e._v(" "),a("keep-alive",[a("planTable",{attrs:{defaultFilters:e.filters},on:{createCBEvent:e.createCBEvent}})],1)],1),e._v(" "),a("el-tab-pane",{staticClass:"fontColor",attrs:{name:"editing",lazy:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-edit"}),e._v(" 编辑中\n          ")]),e._v(" "),a("keep-alive",[a("phTab",{ref:"editTable",attrs:{type:"editing"}})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{name:"auditing",lazy:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-s-check"}),e._v(" 待审核\n          ")]),e._v(" "),a("keep-alive",[a("phTab",{attrs:{type:"auditing"}})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{name:"executing",lazy:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-s-flag"}),e._v(" 执行中\n          ")]),e._v(" "),a("keep-alive",[a("phTab",{attrs:{type:"executing"}})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{name:"complete",lazy:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-s-claim"}),e._v(" 完成\n          ")]),e._v(" "),a("keep-alive",[a("phTab",{attrs:{type:"complete"}})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{name:"all",lazy:""}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-s-order"}),e._v(" 全部\n          ")]),e._v(" "),a("keep-alive",[a("phTab",{attrs:{type:"all"}})],1)],1)],1)],1)])])},r=[],n=a("9665"),s=a("0f03"),o="s=",l={components:{phTab:n["default"],planTable:s["default"]},data:function(){return{title:"采购单管理",activeStatus:location.href.indexOf(o)>-1&&null!==this.$route.query.s?this.$route.query.s:"editing"}},computed:{filters:function(){return{field:"status",op:"in",data:"2,3 "}}},methods:{handleTabClick:function(e,t){var a="?s=",i="/m2/ProcurementOrder_index",r=location.origin+"/#"+i+a+this.activeStatus;history.pushState(history.state,"ph-table search",r)},createCBEvent:function(e){e&&this.$refs.editTable&&this.$refs.editTable.onRefreshTable()}}},c=l,u=a("2877"),p=Object(u["a"])(c,i,r,!1,null,"441d5c8e",null);t["default"]=p.exports},"092f":function(e,t,a){},"0f03":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ph-table"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchParam,id:"filter-form","inline-message":""},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"编码"}},[a("el-input",{staticStyle:{width:"110px"},attrs:{size:"mini",placeholder:"请输入编码"},model:{value:e.searchParam.code.value,callback:function(t){e.$set(e.searchParam.code,"value",t)},expression:"searchParam.code.value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{staticStyle:{width:"110px"},attrs:{size:"mini",placeholder:"请输入名称"},model:{value:e.searchParam.name.value,callback:function(t){e.$set(e.searchParam.name,"value",t)},expression:"searchParam.name.value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"期望交货日期"}},[a("el-date-picker",{attrs:{size:"mini",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchParam.limitTime.value,callback:function(t){e.$set(e.searchParam.limitTime,"value",t)},expression:"searchParam.limitTime.value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",filterable:"",placeholder:"请选择状态"},model:{value:e.searchParam.status.value,callback:function(t){e.$set(e.searchParam.status,"value",t)},expression:"searchParam.status.value"}},e._l(e.statusSelectOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{"native-type":"submit",type:"primary",size:"mini"},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{stripe:"",border:"","highlight-current-row":"","row-class-name":e.dangerClassName,"cell-class-name":"ph-cell","header-cell-class-name":"ph-cell-header",data:e.data,"max-height":e.tableMaxHeight,id:"table"},on:{"selection-change":e.handleSelectionChange,"sort-change":e.handleSortChange}},[a("el-table-column",{attrs:{prop:"code",label:"采购计划编号",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{prop:"statusName",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"small",type:1===t.row.status?"warning":0===t.row.status?"danger":2===t.row.status?"primary":8===t.row.status?"info":"success","disable-transitions":""}},[e._v(e._s(t.row.statusName)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"note",label:"下单完成度",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{placement:"top-start",title:"下单完成度",width:"250",trigger:"hover"}},[a("div",[e._v("\n            完成度："+e._s(t.row.qty.orderedCompleteness)+"%"),a("BR"),e._v("\n            总件数："+e._s(t.row.qty.qty)+" 件"),a("BR"),e._v("\n            已下单："+e._s(t.row.qty.orderQty)+" 件 "),a("BR")],1),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":16,percentage:t.row.qty.orderedCompleteness>100?100:t.row.qty.orderedCompleteness,status:"success"}})],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"categoryName",label:"分类","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.categoryName&&t.row.categoryName.length>10?a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover"}},[a("div",{domProps:{innerHTML:e._s(t.row.categoryName)}}),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.categoryName?t.row.categoryName.length>10?t.row.categoryName.substr(0,8)+"..":t.row.categoryName:""))])]):a("span",[e._v("\n          "+e._s(t.row.categoryName)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.name&&t.row.name.length>18?a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover"}},[a("div",{domProps:{innerHTML:e._s(t.row.name)}}),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.name?t.row.name.length>18?t.row.name.substr(0,16)+"..":t.row.name:""))])]):a("span",[e._v("\n          "+e._s(t.row.name)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"formatLimitTime",label:"期望交货日期",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"note",label:"交货要求",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.note&&t.row.note.length>10?a("el-popover",{attrs:{placement:"top-start",title:"交货要求",width:"250",trigger:"hover"}},[a("div",{domProps:{innerHTML:e._s(t.row.formatNote)}}),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.note?t.row.note.substr(0,8)+"..":""))])]):a("span",[e._v("\n          "+e._s(t.row.formatNote)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"creator.name",label:"创建人",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),e._v(" "),e.hasOperation?a("el-table-column",{attrs:{label:"操作",width:"60",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasEdit?a("el-button",{attrs:{size:"small",icon:"el-icon-document-add",circle:"",type:"success",id:"ph-table-edit"},on:{click:function(a){return e.onDefaultEdit(t.row)}}}):e._e()]}}],null,!1,209646743)}):e._e()],1),e._v(" "),a("el-pagination",{ref:"pageForm",staticStyle:{"text-align":"right",padding:"10px 0"},attrs:{"current-page":e.page,"page-sizes":e.paginationSizes,"page-size":e.size,total:e.total,background:"",layout:e.layout,id:"ph-table-page"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-button",{staticClass:"btn-prev",attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.onRefreshTable}})],1),e._v(" "),a("createDialog",{ref:"createDialog",on:{createCBEvent:e.createCBEvent}})],1)},r=[],n=(a("386d"),a("6b54"),a("456d"),a("ac6a"),a("7f7f"),a("55dd"),a("a481"),a("4917"),a("cebc")),s=(a("3b2b"),a("2f62")),o=a("4328"),l=a.n(o),c=a("c971"),u=a("94d8"),p="~",h=new RegExp(p,"g"),d=",",m="=",f=/=/g,v="q=",g=new RegExp("q=.*"+d),b={components:{createDialog:u["default"]},props:{type:{type:String,default:"valid"},defaultFilters:{type:Object,default:{}}},computed:Object(n["a"])({},Object(s["b"])(["device","rolePower","rolePower"]),{hasCompleteness:function(){return!0}}),data:function(){return{tableMaxHeight:"mobile"!==this.device?400:4e7,hasOperation:!0,hasEdit:!0,hasDelete:!0,selected:[],size:20,page:1,layout:"total, sizes, slot, prev, pager, next, jumper",paginationSizes:[1,20,50,100],total:0,url:"/procurementPlans",countUrl:"/procurementPlans/count",relations:["creator"],data:[],phSort:{prop:"limitTime",order:"asc"},loading:!1,statusSelectOptions:[],categorySelectOptions:[],searchParam:{categoryId:{value:null,op:"in",id:"categoryId"},name:{value:null,op:"bw",id:"name"},limitTime:{value:null,op:"timeRange",id:"limitTime"},status:{value:null,op:"eq",id:"status"},code:{value:null,op:"bw",id:"name"}},dialogTitle:"新增",dialogVisible:!1,isNew:!0,isEdit:!1,isView:!1,row:{}}},created:function(){},mounted:function(){var e=this;window.onresize=function(){e.getTableHeight()};var t=location.href.match(g);if(t){var a=t[0].substr(2).replace(h,m),i=l.a.parse(a,{delimiter:d});this.page=i.currentPage?1*i.currentPage:this.page,this.size=i.pageSize?1*i.pageSize:this.size,this.phSort.prop=i.sort?i.sort:this.phSort.prop,this.phSort.order=i.dir?i.dir:this.phSort.order,i.categoryId&&(this.searchParam.categoryId.value=i.categoryId),i.limitTime&&(this.searchParam.limitTime.value=i.limitTime),i.name&&(this.searchParam.name.value=i.name),i.status&&(this.searchParam.status.value=i.status),i.code&&(this.searchParam.code.value=i.code)}this.$nextTick(function(){e.getTableHeight(),e.initData(),e.getList()})},methods:{initData:function(){this.statusSelectOptions=c["a"].getSelectOptions("ProcurementPlanStatus"),"editing"===this.type||("auditing"===this.type?this.hasDelete=!1:"executing"===this.type?this.hasDelete=!1:"complete"===this.type?this.hasDelete=!1:this.type)},getTableHeight:function(){if("mobile"!==this.device){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=e;t-=84,t-=this.$refs.searchForm?this.$refs.searchForm.$el.offsetHeight:0,t-=this.$refs.operationForm?this.$refs.operationForm.$el.offsetHeight:0,t-=this.$refs.pageForm?this.$refs.pageForm.$el.offsetHeight:0,t-=82,this.tableMaxHeight=t}else this.tableMaxHeight=400},search:function(){var e=this;this.$refs.searchForm.validate(function(t){t&&(e.page=1,e.getList(!0))})},resetSearch:function(){var e=this;this.$refs.searchForm.resetFields(),this.page=1,this.searchParam.categoryId.value=null,this.searchParam.limitTime.value=null,this.searchParam.name.value=null,this.searchParam.status.value=null,this.searchParam.code.value=null,history.replaceState(history.state,"",location.href.replace(g,"")),this.$nextTick(function(){e.getList()}),this.$emit("reset"),this.$emit("update:customQuery",Object.assign(this.customQuery,JSON.parse(this.initCustomQuery)))},exempleFormatter:function(e,t){return""},dangerClassName:function(e){var t=e.row;if(t.limitTime>0){var a=(t.limitTime-new Date)/864e5;if(a>0&&a<=10)return"warning-row";if(a<=0)return"danger-row"}return""},getList:function(e){var t=this,a=this.url,i=this.countUrl,r="",n="",s=this.size,o=this.page;if(a)if(i){a.indexOf("?")>-1?a+="&":a+="?",i.indexOf("?")>-1?i+="&":i+="?",r+="pageSize=".concat(s,"&currentPage=").concat(o),n+="pageSize=".concat(s,"&currentPage=").concat(o),this.phSort&&(r+="&sort=".concat(this.phSort.prop,"&dir=").concat(this.phSort.order),n+="&sort=".concat(this.phSort.prop,"&dir=").concat(this.phSort.order));var l=[];if(Object.keys(this.searchParam).filter(function(e){return t.searchParam[e]&&""!==t.searchParam[e].value&&null!==t.searchParam[e].value&&void 0!==t.searchParam[e].value}).forEach(function(e){l.push({field:e,op:t.searchParam[e].op?t.searchParam[e].op:"eq",data:t.searchParam[e].value?encodeURIComponent(t.searchParam[e].value.toString().trim()):""})}),l.forEach(function(e,t){n+="&"+e.field+"="+encodeURIComponent(e.data?e.data.toString().trim():"")}),l.push(JSON.parse(JSON.stringify(this.defaultFilters))),l&&l.length>0&&(r+="&filters="+JSON.stringify({groupOp:"AND",rules:l})),this.relations&&this.relations.length>0&&(r+="&relations="+JSON.stringify(this.relations)),this.loading=!0,this.global.axios.get(i+r).then(function(e){var a=e.data;t.total=a||0}).catch(function(e){}),this.global.axios.get(a+r).then(function(e){var a=e.data,i=a||[];t.data=i,t.loading=!1,t.$emit("update",i,a)}).catch(function(e){t.$emit("error",e),t.loading=!1}),e>0){var c="",u=v+n.replace(/&/g,d).replace(f,p)+d;if(location.href.indexOf(v)>-1)c=location.href.replace(g,u);else{var h=location.href.indexOf("?")>-1?"&".concat(u):"?".concat(u);c=location.origin+location.pathname+location.search+location.hash+h}history.pushState(history.state,"ph-table search",c)}}else console.warn("countUrl 为空, 异常！如果不需要统计结果数量。请查找删除 countUrl 相关代码!");else console.warn("url 为空, 不发送请求")},handleSelectionChange:function(e){this.selected=e,this.$emit("selection-change",e)},handleSortChange:function(e){e.prop&&(this.phSort.prop=e.prop,this.phSort.order="ascending"===e.order?"asc":"desc"),this.page=1,this.getList(!0)},handleSizeChange:function(e){this.size!==e&&(this.page=1,this.size=e,this.getList(!0))},handleCurrentChange:function(e){this.page!==e&&(this.page=e,this.getList(!0))},onRefreshTable:function(){this.getList()},onDefaultEdit:function(e){this.$refs.createDialog.openDialog(e.id)},createCBEvent:function(e){this.getList()}}},y=b,_=(a("39c7"),a("2877")),w=Object(_["a"])(y,i,r,!1,null,"6530bc18",null);t["default"]=w.exports},"1d94":function(e,t,a){"use strict";var i=a("092f"),r=a.n(i);r.a},2957:function(e,t,a){"use strict";var i=a("b04e"),r=a.n(i);r.a},"2f21":function(e,t,a){"use strict";var i=a("79e5");e.exports=function(e,t){return!!e&&i(function(){t?e.call(null,function(){},1):e.call(null)})}},"34c2":function(e,t,a){"use strict";var i=a("6520"),r=a.n(i);r.a},"39c7":function(e,t,a){"use strict";var i=a("c11b"),r=a.n(i);r.a},"3fc2":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[a("aside",{staticStyle:{"font-size":"12px"}},[e._v("\n    您可以在这里上传一些跟本次采购相关的文件。方便以后查询。\n  ")]),e._v(" "),a("h5",[e._v("附件: ")]),e._v(" "),e.completed?a("attachment",{ref:"attachment",attrs:{primary:e.primary}}):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"warning"},on:{click:e.onBack}},[e._v("\n          < 上一步\n        ")])],1)],1),e._v(" "),a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:e.onNext}},[e._v("\n          下一步 >\n        ")])],1)],1)],1)],1)},r=[],n=(a("c5f6"),a("6b1f")),s={components:{attachment:n["default"]},props:{primaryId:{type:[Number,String],default:null}},computed:{},data:function(){return{completed:!1,primary:{}}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){e.initData()})},methods:{initData:function(){var e=this;this.primaryId&&this.global.axios.get("/procurementOrders/".concat(this.primaryId)).then(function(t){var a=t.data;e.primary=a||{},e.completed=!0}).catch(function(t){e.completed=!0})},onNext:function(){this.$emit("step3CBEvent",3)},onBack:function(){this.$emit("step3CBEvent",1)},reloadCBEvent:function(){this.initData()}}},o=s,l=(a("1d94"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,"1c933d73",null);t["default"]=c.exports},"55dd":function(e,t,a){"use strict";var i=a("5ca1"),r=a("d8e8"),n=a("4bf8"),s=a("79e5"),o=[].sort,l=[1,2,3];i(i.P+i.F*(s(function(){l.sort(void 0)})||!s(function(){l.sort(null)})||!a("2f21")(o)),"Array",{sort:function(e){return void 0===e?o.call(n(this)):o.call(n(this),r(e))}})},6520:function(e,t,a){},8656:function(e,t,a){"use strict";var i=a("acbb"),r=a.n(i);r.a},"94d8":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.dialogVisible?a("el-dialog",{staticClass:"ph-dialog",attrs:{title:e.title,visible:e.dialogVisible,fullscreen:""},on:{"update:visible":function(t){e.dialogVisible=t},close:e.closeDialog}},[a("el-steps",{attrs:{active:e.stepsActive,"finish-status":"success","align-center":"",simple:""}},[a("el-step",{attrs:{title:"1.下单",icon:"el-icon-shopping-cart-full"}}),e._v(" "),a("el-step",{attrs:{title:"2.指派工作",icon:"el-icon-s-custom"}}),e._v(" "),a("el-step",{attrs:{title:"3.附件",icon:"el-icon-s-check"}}),e._v(" "),a("el-step",{attrs:{title:"4.申请预付款",icon:"el-icon-money"}})],1),e._v(" "),0==e.stepsActive&&e.primaryComplete?a("step1",{attrs:{primary:e.primary},on:{step1CBEvent:e.step1CBEvent}}):e._e(),e._v(" "),1==e.stepsActive?a("step2",{attrs:{primaryId:e.orderId},on:{step2CBEvent:e.step2CBEvent}}):e._e(),e._v(" "),2==e.stepsActive?a("step3",{attrs:{primaryId:e.orderId},on:{step3CBEvent:e.step3CBEvent}}):e._e(),e._v(" "),3==e.stepsActive?a("step4",{attrs:{primaryId:e.orderId},on:{step4CBEvent:e.step4CBEvent}}):e._e()],1):e._e()},r=[],n=(a("7f7f"),a("cebc")),s=a("2f62"),o=a("9679"),l=a("e1e7"),c=a("3fc2"),u=a("d5bc"),p={components:{step1:o["default"],step2:l["default"],step3:c["default"],step4:u["default"]},props:{},computed:Object(n["a"])({},Object(s["b"])(["device","rolePower"]),{title:function(){return"采购计划下单 ["+this.primary.name+"]"}}),data:function(){return{primaryId:null,orderId:null,primary:{},stepsActive:0,primaryComplete:!1,dialogVisible:!1}},created:function(){},mounted:function(){this.$nextTick(function(){})},methods:{initData:function(){var e=this;this.primaryId&&this.global.axios.get("/procurementPlans/".concat(this.primaryId)).then(function(t){var a=t.data;e.primary=a||{},e.dialogVisible=!0,e.primaryComplete=!0}).catch(function(e){})},openDialog:function(e){this.primaryId=e,this.initData()},closeDialog:function(){this.primary={},this.primaryId=null,this.stepsActive=0,this.dialogVisible=!1,this.primaryComplete=!1},step1CBEvent:function(e){this.$emit("createCBEvent",e),this.orderId=e.id,this.stepsActive=1},step2CBEvent:function(e){this.stepsActive=2},step3CBEvent:function(e){this.stepsActive=e},step4CBEvent:function(e){"close"==e?this.closeDialog():this.stepsActive=e}}},h=p,d=(a("f9f7"),a("2877")),m=Object(d["a"])(h,i,r,!1,null,"c55b1974",null);t["default"]=m.exports},9665:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("infoTable",{ref:"infoTable",attrs:{type:e.type,defaultFilters:e.filters}})},r=[],n=a("d523"),s={components:{infoTable:n["default"]},props:{type:{type:String,default:"valid"}},computed:{filters:function(){return"editing"===this.type?{field:"status",op:"in",data:1}:"auditing"===this.type?{field:"status",op:"in",data:2}:"executing"===this.type?{field:"status",op:"in",data:"3,4,5,6,7,8,9,10,11"}:"complete"===this.type?{field:"status",op:"in",data:11}:"all"===this.type?{}:void 0}},methods:{onRefreshTable:function(){this.$refs.infoTable.onRefreshTable()}}},o=s,l=a("2877"),c=Object(l["a"])(o,i,r,!1,null,null,null);t["default"]=c.exports},a308:function(e,t,a){},acbb:function(e,t,a){},b04e:function(e,t,a){},c11b:function(e,t,a){},d523:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ph-table"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchParam,id:"filter-form","inline-message":""},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"编码"}},[a("el-input",{staticStyle:{width:"110px"},attrs:{size:"mini",placeholder:"请输入编码"},model:{value:e.searchParam.code.value,callback:function(t){e.$set(e.searchParam.code,"value",t)},expression:"searchParam.code.value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{staticStyle:{width:"110px"},attrs:{size:"mini",placeholder:"请输入名称"},model:{value:e.searchParam.name.value,callback:function(t){e.$set(e.searchParam.name,"value",t)},expression:"searchParam.name.value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"供货商"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",filterable:"",placeholder:"请选择供货商"},model:{value:e.searchParam.supplierId.value,callback:function(t){e.$set(e.searchParam.supplierId,"value",t)},expression:"searchParam.supplierId.value"}},e._l(e.supplierSelectOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",filterable:"",placeholder:"请选择状态"},model:{value:e.searchParam.status.value,callback:function(t){e.$set(e.searchParam.status,"value",t)},expression:"searchParam.status.value"}},e._l(e.statusSelectOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{"native-type":"submit",type:"primary",size:"mini"},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{stripe:"",border:"","highlight-current-row":"","row-class-name":e.dangerClassName,"cell-class-name":"ph-cell","header-cell-class-name":"ph-cell-header",data:e.data,"max-height":e.tableMaxHeight,id:"table"},on:{"selection-change":e.handleSelectionChange,"sort-change":e.handleSortChange}},[a("el-table-column",{attrs:{prop:"code",label:"编号",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{prop:"statusName",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"small",type:1===t.row.status?"warning":0===t.row.status?"danger":2===t.row.status?"primary":11===t.row.status?"info":"success","disable-transitions":""}},[e._v(" "+e._s(t.row.statusName)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"计划名称","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.procurementPlan.name&&t.row.procurementPlan.name.length>27?a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover"}},[a("div",{domProps:{innerHTML:e._s(t.row.procurementPlan.name)}}),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.procurementPlan.name?t.row.procurementPlan.name.length>27?t.row.procurementPlan.name.substr(0,25)+"..":t.row.procurementPlan.name:""))])]):a("span",[e._v("\n          "+e._s(t.row.procurementPlan.name)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"supplier.name",label:"供货商",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehouse.name",label:"收货仓库",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"settlementMethodName",label:"结算方式",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"currency.name",label:"结算货币",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"accountPeriod",label:"帐期(天)",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"formatOtdTime",label:"预计完成日期",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"procurementPlan.note",label:"交货要求",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.procurementPlan.note&&t.row.procurementPlan.note.length>10?a("el-popover",{attrs:{placement:"top-start",title:"交货要求",width:"250",trigger:"hover"}},[a("div",{domProps:{innerHTML:e._s(t.row.procurementPlan.formatNote)}}),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.procurementPlan.note?t.row.procurementPlan.note.substr(0,8)+"..":""))])]):a("span",[e._v("\n          "+e._s(t.row.procurementPlan.formatNote)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"creator.name",label:"创建人",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),e._v(" "),e.hasOperation?a("el-table-column",{attrs:{label:"操作",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasEdit?a("el-button",{attrs:{size:"small",icon:"el-icon-edit",circle:"",type:"primary",id:"ph-table-edit"},on:{click:function(a){return e.onDefaultEdit(t.row)}}}):e._e(),e._v(" "),e.hasDelete?a("el-button",{attrs:{type:"danger",size:"mini",id:"ph-table-del",icon:"el-icon-delete",circle:""},on:{click:function(a){return e.onDefaultDelete(t.row)}}}):e._e()]}}],null,!1,277848559)}):e._e()],1),e._v(" "),a("el-pagination",{ref:"pageForm",staticStyle:{"text-align":"right",padding:"10px 0"},attrs:{"current-page":e.page,"page-sizes":e.paginationSizes,"page-size":e.size,total:e.total,background:"",layout:e.layout,id:"ph-table-page"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},[a("el-button",{staticClass:"btn-prev",attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.onRefreshTable}})],1),e._v(" "),a("editDialog",{ref:"editDialog",on:{modifyCBEvent:e.modifyCBEvent}})],1)},r=[],n=(a("386d"),a("6b54"),a("456d"),a("ac6a"),a("7f7f"),a("55dd"),a("a481"),a("4917"),a("cebc")),s=(a("3b2b"),a("2f62")),o=a("4328"),l=a.n(o),c=a("bc8e"),u=a("c971"),p=a("3978"),h=a("a6b9"),d="~",m=new RegExp(d,"g"),f=",",v="=",g=/=/g,b="q=",y=new RegExp("q=.*"+f),_={components:{editDialog:c["default"],phPercentage:p["a"]},props:{type:{type:String,default:"valid"},defaultFilters:{type:Object,default:{}}},computed:Object(n["a"])({},Object(s["b"])(["device","rolePower","rolePower"]),{hasCompleteness:function(){return"editing"!==this.type&&("auditing"!==this.type&&("executing"===this.type||("complete"===this.type||("all"===this.type||void 0))))}}),data:function(){return{tableMaxHeight:"mobile"!==this.device?400:4e7,hasOperation:!0,hasEdit:!0,hasDelete:!0,selected:[],size:20,page:1,layout:"total, sizes, slot, prev, pager, next, jumper",paginationSizes:[1,20,50,100],total:0,url:"/procurementOrders",countUrl:"/procurementOrders/count",relations:["procurementPlan","creator","currency","supplier","warehouse"],data:[],phSort:{prop:"id",order:"desc"},loading:!1,statusSelectOptions:[],supplierSelectOptions:[],searchParam:{supplierId:{value:null,op:"in",id:"supplierId"},name:{value:null,op:"bw",id:"name"},status:{value:null,op:"eq",id:"status"},code:{value:null,op:"bw",id:"name"}},dialogTitle:"新增",dialogVisible:!1,isNew:!0,isEdit:!1,isView:!1,row:{}}},created:function(){},mounted:function(){var e=this;window.onresize=function(){e.getTableHeight()};var t=location.href.match(y);if(t){var a=t[0].substr(2).replace(m,v),i=l.a.parse(a,{delimiter:f});this.page=i.currentPage?1*i.currentPage:this.page,this.size=i.pageSize?1*i.pageSize:this.size,this.phSort.prop=i.sort?i.sort:this.phSort.prop,this.phSort.order=i.dir?i.dir:this.phSort.order,i.supplierId&&(this.searchParam.supplierId.value=i.supplierId),i.name&&(this.searchParam.name.value=i.name),i.status&&(this.searchParam.status.value=i.status),i.code&&(this.searchParam.code.value=i.code)}this.$nextTick(function(){e.getTableHeight(),e.initData(),e.getList()})},methods:{initData:function(){this.statusSelectOptions=u["a"].getSelectOptions("ProcurementOrderStatus"),this.supplierSelectOptions=h["a"].getSelectOptions(),"editing"===this.type||("auditing"===this.type?this.hasDelete=!1:"executing"===this.type?this.hasDelete=!1:"complete"===this.type?this.hasDelete=!1:this.type)},getTableHeight:function(){if("mobile"!==this.device){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=e;t-=84,t-=this.$refs.searchForm?this.$refs.searchForm.$el.offsetHeight:0,t-=this.$refs.operationForm?this.$refs.operationForm.$el.offsetHeight:0,t-=this.$refs.pageForm?this.$refs.pageForm.$el.offsetHeight:0,t-=82,this.tableMaxHeight=t}else this.tableMaxHeight=400},search:function(){var e=this;this.$refs.searchForm.validate(function(t){t&&(e.page=1,e.getList(!0))})},resetSearch:function(){var e=this;this.$refs.searchForm.resetFields(),this.page=1,this.searchParam.supplierId.value=null,this.searchParam.name.value=null,this.searchParam.status.value=null,this.searchParam.code.value=null,history.replaceState(history.state,"",location.href.replace(y,"")),this.$nextTick(function(){e.getList()}),this.$emit("reset"),this.$emit("update:customQuery",Object.assign(this.customQuery,JSON.parse(this.initCustomQuery)))},exempleFormatter:function(e,t){return""},dangerClassName:function(e){e.row;return""},getList:function(e){var t=this,a=this.url,i=this.countUrl,r="",n="",s=this.size,o=this.page;if(a)if(i){a.indexOf("?")>-1?a+="&":a+="?",i.indexOf("?")>-1?i+="&":i+="?",r+="pageSize=".concat(s,"&currentPage=").concat(o),n+="pageSize=".concat(s,"&currentPage=").concat(o),this.phSort&&(r+="&sort=".concat(this.phSort.prop,"&dir=").concat(this.phSort.order),n+="&sort=".concat(this.phSort.prop,"&dir=").concat(this.phSort.order));var l=[];if(Object.keys(this.searchParam).filter(function(e){return t.searchParam[e]&&""!==t.searchParam[e].value&&null!==t.searchParam[e].value&&void 0!==t.searchParam[e].value}).forEach(function(e){l.push({field:e,op:t.searchParam[e].op?t.searchParam[e].op:"eq",data:t.searchParam[e].value?encodeURIComponent(t.searchParam[e].value.toString().trim()):""})}),l.forEach(function(e,t){n+="&"+e.field+"="+encodeURIComponent(e.data?e.data.toString().trim():"")}),l.push(JSON.parse(JSON.stringify(this.defaultFilters))),l&&l.length>0&&(r+="&filters="+JSON.stringify({groupOp:"AND",rules:l})),this.relations&&this.relations.length>0&&(r+="&relations="+JSON.stringify(this.relations)),this.loading=!0,this.global.axios.get(i+r).then(function(e){var a=e.data;t.total=a||0}).catch(function(e){}),this.global.axios.get(a+r).then(function(e){var a=e.data,i=a||[];t.data=i,t.loading=!1,t.$emit("update",i,a)}).catch(function(e){t.$emit("error",e),t.loading=!1}),e>0){var c="",u=b+n.replace(/&/g,f).replace(g,d)+f;if(location.href.indexOf(b)>-1)c=location.href.replace(y,u);else{var p=location.href.indexOf("?")>-1?"&".concat(u):"?".concat(u);c=location.origin+location.pathname+location.search+location.hash+p}history.pushState(history.state,"ph-table search",c)}}else console.warn("countUrl 为空, 异常！如果不需要统计结果数量。请查找删除 countUrl 相关代码!");else console.warn("url 为空, 不发送请求")},handleSelectionChange:function(e){this.selected=e,this.$emit("selection-change",e)},handleSortChange:function(e){e.prop&&(this.phSort.prop=e.prop,this.phSort.order="ascending"===e.order?"asc":"desc"),this.page=1,this.getList(!0)},handleSizeChange:function(e){this.size!==e&&(this.page=1,this.size=e,this.getList(!0))},handleCurrentChange:function(e){this.page!==e&&(this.page=e,this.getList(!0))},onRefreshTable:function(){this.getList()},onDefaultEdit:function(e){this.$refs.editDialog.openDialog(e.id)},onDefaultDelete:function(e){var t=this,a="".concat(this.url,"/").concat(e.id);this.$confirm("确认删除吗?","提示",{type:"warning",beforeClose:function(e,i,r){"confirm"==e?(t.loading=!0,t.global.axios.delete(a).then(function(e){t.loading=!1,t.$message.info("删除成功!"),r(),t.getList()}).catch(function(e){t.loading=!1})):r()}}).catch(function(e){})},modifyCBEvent:function(e){this.getList()}}},w=_,S=(a("8656"),a("2877")),P=Object(S["a"])(w,i,r,!1,null,"0ca218cc",null);t["default"]=P.exports},d5bc:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[e.completed?a("payment",{ref:"payment",attrs:{primary:e.primary},on:{paymentCBEvent:e.paymentCBEvent}}):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"warning"},on:{click:e.onBack}},[e._v("\n          < 上一步\n        ")])],1)],1),e._v(" "),a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:e.onNext}},[e._v("\n          完成\n        ")])],1)],1)],1)],1)},r=[],n=(a("c5f6"),a("f188")),s={components:{payment:n["default"]},props:{primaryId:{type:[Number,String],default:null}},computed:{},data:function(){return{completed:!1,primary:{}}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){e.initData()})},methods:{initData:function(){var e=this;if(this.primaryId){var t="/procurementOrders/".concat(this.primaryId);t+="?relations="+JSON.stringify(["supplier","currency"]),this.global.axios.get(t).then(function(t){var a=t.data;e.primary=a||{},e.completed=!0}).catch(function(t){e.completed=!0})}},saveAuditCBEvent:function(e){var t=this;this.$confirm("确认将该计划提交给上级审核吗?","提示",{type:"warning",beforeClose:function(a,i,r){if("confirm"==a){var n=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s="/procurementPlans/commit/".concat(t.primaryId);t.global.axios.put(s,e).then(function(e){r(),t.$message.info("提交成功,请耐心等待上级处理! 您还可以继续创建新的采购计划! "),t.$refs.auditing.closeDialog(),n.close(),t.$emit("step4CBEvent",0)}).catch(function(e){n.close()}),r()}else r()}}).catch(function(e){})},onNext:function(){this.$emit("step4CBEvent","close")},onBack:function(){this.$emit("step4CBEvent",2)},reloadCBEvent:function(){this.initData()},paymentCBEvent:function(e){}}},o=s,l=(a("2957"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,"71fdb407",null);t["default"]=c.exports},e1e7:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[a("aside",{staticStyle:{"font-size":"12px"}},[e._v("\n    为了保证本采购单的顺利执行，需要指派对应的跟单、仓管负责人，可多选。指派的负责人将会收到对应的邮件和系统消息提醒。\n  ")]),e._v(" "),a("h5",[e._v("负责人：")]),e._v(" "),e.completed?a("person",{ref:"person",attrs:{primary:e.primary},on:{reloadCBEvent:e.reloadCBEvent}}):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{md:24}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:e.onNext}},[e._v("\n          下一步 >\n        ")])],1)],1)],1)],1)},r=[],n=(a("c5f6"),a("4155")),s={components:{person:n["default"]},props:{primaryId:{type:[Number,String],default:null}},computed:{},data:function(){return{completed:!1,primary:{}}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){e.initData()})},methods:{initData:function(){var e=this;this.primaryId&&this.global.axios.get("/procurementOrders/".concat(this.primaryId)).then(function(t){var a=t.data;e.primary=a||{},e.completed=!0}).catch(function(t){e.completed=!0})},onNext:function(){this.primary&&this.primary.dataAuthories&&this.primary.dataAuthories.length>0?this.$emit("step2CBEvent",3):this.$message.error("必须选择至少一位负责人")},reloadCBEvent:function(){this.initData()}}},o=s,l=(a("34c2"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,"2300cf8f",null);t["default"]=c.exports},f9f7:function(e,t,a){"use strict";var i=a("a308"),r=a.n(i);r.a}}]);