(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-aed77126","chunk-509f0878","chunk-67de497e","chunk-3f362562","chunk-744bde02","chunk-c08004ae","chunk-4caa33da","chunk-7d54fa6d"],{"092f":function(t,e,a){},"0f03":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ph-table"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:t.searchParam,id:"filter-form","inline-message":""},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"编码"}},[a("el-input",{staticStyle:{width:"110px"},attrs:{size:"mini",placeholder:"请输入编码"},model:{value:t.searchParam.code.value,callback:function(e){t.$set(t.searchParam.code,"value",e)},expression:"searchParam.code.value"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{staticStyle:{width:"110px"},attrs:{size:"mini",placeholder:"请输入名称"},model:{value:t.searchParam.name.value,callback:function(e){t.$set(t.searchParam.name,"value",e)},expression:"searchParam.name.value"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"期望交货日期"}},[a("el-date-picker",{attrs:{size:"mini",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchParam.limitTime.value,callback:function(e){t.$set(t.searchParam.limitTime,"value",e)},expression:"searchParam.limitTime.value"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{size:"mini",filterable:"",placeholder:"请选择状态"},model:{value:t.searchParam.status.value,callback:function(e){t.$set(t.searchParam.status,"value",e)},expression:"searchParam.status.value"}},t._l(t.statusSelectOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{"native-type":"submit",type:"primary",size:"mini"},on:{click:t.search}},[t._v("查询")]),t._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:t.resetSearch}},[t._v("重置")])],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{stripe:"",border:"","highlight-current-row":"","row-class-name":t.dangerClassName,"cell-class-name":"ph-cell","header-cell-class-name":"ph-cell-header",data:t.data,"max-height":t.tableMaxHeight,id:"table"},on:{"selection-change":t.handleSelectionChange,"sort-change":t.handleSortChange}},[a("el-table-column",{attrs:{prop:"code",label:"采购计划编号",width:"140"}}),t._v(" "),a("el-table-column",{attrs:{prop:"statusName",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small",type:1===e.row.status?"warning":0===e.row.status?"danger":2===e.row.status?"primary":8===e.row.status?"info":"success","disable-transitions":""}},[t._v(t._s(e.row.statusName)+"\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"note",label:"下单完成度",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",title:"下单完成度",width:"250",trigger:"hover"}},[a("div",[t._v("\n            完成度："+t._s(e.row.qty.orderedCompleteness)+"%"),a("BR"),t._v("\n            总件数："+t._s(e.row.qty.qty)+" 件"),a("BR"),t._v("\n            已下单："+t._s(e.row.qty.orderQty)+" 件 "),a("BR")],1),t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":16,percentage:e.row.qty.orderedCompleteness>100?100:e.row.qty.orderedCompleteness,status:"success"}})],1)])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"categoryName",label:"分类","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.categoryName&&e.row.categoryName.length>10?a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover"}},[a("div",{domProps:{innerHTML:t._s(e.row.categoryName)}}),t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(e.row.categoryName?e.row.categoryName.length>10?e.row.categoryName.substr(0,8)+"..":e.row.categoryName:""))])]):a("span",[t._v("\n          "+t._s(e.row.categoryName)+"\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.name&&e.row.name.length>18?a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover"}},[a("div",{domProps:{innerHTML:t._s(e.row.name)}}),t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(e.row.name?e.row.name.length>18?e.row.name.substr(0,16)+"..":e.row.name:""))])]):a("span",[t._v("\n          "+t._s(e.row.name)+"\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"formatLimitTime",label:"期望交货日期",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"note",label:"交货要求",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.note&&e.row.note.length>10?a("el-popover",{attrs:{placement:"top-start",title:"交货要求",width:"250",trigger:"hover"}},[a("div",{domProps:{innerHTML:t._s(e.row.formatNote)}}),t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(e.row.note?e.row.note.substr(0,8)+"..":""))])]):a("span",[t._v("\n          "+t._s(e.row.formatNote)+"\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"creator.name",label:"创建人",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),t._v(" "),t.hasOperation?a("el-table-column",{attrs:{label:"操作",width:"60",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hasEdit?a("el-button",{attrs:{size:"small",icon:"el-icon-document-add",circle:"",type:"success",id:"ph-table-edit"},on:{click:function(a){return t.onDefaultEdit(e.row)}}}):t._e()]}}],null,!1,209646743)}):t._e()],1),t._v(" "),a("el-pagination",{ref:"pageForm",staticStyle:{"text-align":"right",padding:"10px 0"},attrs:{"current-page":t.page,"page-sizes":t.paginationSizes,"page-size":t.size,total:t.total,background:"",layout:t.layout,id:"ph-table-page"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},[a("el-button",{staticClass:"btn-prev",attrs:{icon:"el-icon-refresh",circle:""},on:{click:t.onRefreshTable}})],1),t._v(" "),a("createDialog",{ref:"createDialog",on:{createCBEvent:t.createCBEvent}})],1)},i=[],r=(a("386d"),a("6b54"),a("456d"),a("ac6a"),a("7f7f"),a("55dd"),a("a481"),a("4917"),a("cebc")),s=(a("3b2b"),a("2f62")),o=a("4328"),l=a.n(o),c=a("c971"),u=a("94d8"),p="~",m=new RegExp(p,"g"),h=",",d="=",f=/=/g,v="q=",g=new RegExp("q=.*"+h),y={components:{createDialog:u["default"]},props:{type:{type:String,default:"valid"},defaultFilters:{type:Object,default:{}}},computed:Object(r["a"])({},Object(s["b"])(["device","rolePower","rolePower"]),{hasCompleteness:function(){return!0}}),data:function(){return{tableMaxHeight:"mobile"!==this.device?400:4e7,hasOperation:!0,hasEdit:!0,hasDelete:!0,selected:[],size:20,page:1,layout:"total, sizes, slot, prev, pager, next, jumper",paginationSizes:[1,20,50,100],total:0,url:"/procurementPlans",countUrl:"/procurementPlans/count",relations:["creator"],data:[],phSort:{prop:"limitTime",order:"asc"},loading:!1,statusSelectOptions:[],categorySelectOptions:[],searchParam:{categoryId:{value:null,op:"in",id:"categoryId"},name:{value:null,op:"bw",id:"name"},limitTime:{value:null,op:"timeRange",id:"limitTime"},status:{value:null,op:"eq",id:"status"},code:{value:null,op:"bw",id:"name"}},dialogTitle:"新增",dialogVisible:!1,isNew:!0,isEdit:!1,isView:!1,row:{}}},created:function(){},mounted:function(){var t=this;window.onresize=function(){t.getTableHeight()};var e=location.href.match(g);if(e){var a=e[0].substr(2).replace(m,d),n=l.a.parse(a,{delimiter:h});this.page=n.currentPage?1*n.currentPage:this.page,this.size=n.pageSize?1*n.pageSize:this.size,this.phSort.prop=n.sort?n.sort:this.phSort.prop,this.phSort.order=n.dir?n.dir:this.phSort.order,n.categoryId&&(this.searchParam.categoryId.value=n.categoryId),n.limitTime&&(this.searchParam.limitTime.value=n.limitTime),n.name&&(this.searchParam.name.value=n.name),n.status&&(this.searchParam.status.value=n.status),n.code&&(this.searchParam.code.value=n.code)}this.$nextTick(function(){t.getTableHeight(),t.initData(),t.getList()})},methods:{initData:function(){this.statusSelectOptions=c["a"].getSelectOptions("ProcurementPlanStatus"),"editing"===this.type||("auditing"===this.type?this.hasDelete=!1:"executing"===this.type?this.hasDelete=!1:"complete"===this.type?this.hasDelete=!1:this.type)},getTableHeight:function(){if("mobile"!==this.device){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=t;e-=84,e-=this.$refs.searchForm?this.$refs.searchForm.$el.offsetHeight:0,e-=this.$refs.operationForm?this.$refs.operationForm.$el.offsetHeight:0,e-=this.$refs.pageForm?this.$refs.pageForm.$el.offsetHeight:0,e-=82,this.tableMaxHeight=e}else this.tableMaxHeight=400},search:function(){var t=this;this.$refs.searchForm.validate(function(e){e&&(t.page=1,t.getList(!0))})},resetSearch:function(){var t=this;this.$refs.searchForm.resetFields(),this.page=1,this.searchParam.categoryId.value=null,this.searchParam.limitTime.value=null,this.searchParam.name.value=null,this.searchParam.status.value=null,this.searchParam.code.value=null,history.replaceState(history.state,"",location.href.replace(g,"")),this.$nextTick(function(){t.getList()}),this.$emit("reset"),this.$emit("update:customQuery",Object.assign(this.customQuery,JSON.parse(this.initCustomQuery)))},exempleFormatter:function(t,e){return""},dangerClassName:function(t){var e=t.row;if(e.limitTime>0){var a=(e.limitTime-new Date)/864e5;if(a>0&&a<=10)return"warning-row";if(a<=0)return"danger-row"}return""},getList:function(t){var e=this,a=this.url,n=this.countUrl,i="",r="",s=this.size,o=this.page;if(a)if(n){a.indexOf("?")>-1?a+="&":a+="?",n.indexOf("?")>-1?n+="&":n+="?",i+="pageSize=".concat(s,"&currentPage=").concat(o),r+="pageSize=".concat(s,"&currentPage=").concat(o),this.phSort&&(i+="&sort=".concat(this.phSort.prop,"&dir=").concat(this.phSort.order),r+="&sort=".concat(this.phSort.prop,"&dir=").concat(this.phSort.order));var l=[];if(Object.keys(this.searchParam).filter(function(t){return e.searchParam[t]&&""!==e.searchParam[t].value&&null!==e.searchParam[t].value&&void 0!==e.searchParam[t].value}).forEach(function(t){l.push({field:t,op:e.searchParam[t].op?e.searchParam[t].op:"eq",data:e.searchParam[t].value?encodeURIComponent(e.searchParam[t].value.toString().trim()):""})}),l.forEach(function(t,e){r+="&"+t.field+"="+encodeURIComponent(t.data?t.data.toString().trim():"")}),l.push(JSON.parse(JSON.stringify(this.defaultFilters))),l&&l.length>0&&(i+="&filters="+JSON.stringify({groupOp:"AND",rules:l})),this.relations&&this.relations.length>0&&(i+="&relations="+JSON.stringify(this.relations)),this.loading=!0,this.global.axios.get(n+i).then(function(t){var a=t.data;e.total=a||0}).catch(function(t){}),this.global.axios.get(a+i).then(function(t){var a=t.data,n=a||[];e.data=n,e.loading=!1,e.$emit("update",n,a)}).catch(function(t){e.$emit("error",t),e.loading=!1}),t>0){var c="",u=v+r.replace(/&/g,h).replace(f,p)+h;if(location.href.indexOf(v)>-1)c=location.href.replace(g,u);else{var m=location.href.indexOf("?")>-1?"&".concat(u):"?".concat(u);c=location.origin+location.pathname+location.search+location.hash+m}history.pushState(history.state,"ph-table search",c)}}else console.warn("countUrl 为空, 异常！如果不需要统计结果数量。请查找删除 countUrl 相关代码!");else console.warn("url 为空, 不发送请求")},handleSelectionChange:function(t){this.selected=t,this.$emit("selection-change",t)},handleSortChange:function(t){t.prop&&(this.phSort.prop=t.prop,this.phSort.order="ascending"===t.order?"asc":"desc"),this.page=1,this.getList(!0)},handleSizeChange:function(t){this.size!==t&&(this.page=1,this.size=t,this.getList(!0))},handleCurrentChange:function(t){this.page!==t&&(this.page=t,this.getList(!0))},onRefreshTable:function(){this.getList()},onDefaultEdit:function(t){this.$refs.createDialog.openDialog(t.id)},createCBEvent:function(t){this.getList()}}},b=y,_=(a("39c7"),a("2877")),w=Object(_["a"])(b,n,i,!1,null,"6530bc18",null);e["default"]=w.exports},"1d94":function(t,e,a){"use strict";var n=a("092f"),i=a.n(n);i.a},2957:function(t,e,a){"use strict";var n=a("b04e"),i=a.n(n);i.a},"2e49":function(t,e,a){"use strict";var n=a("50f8"),i=a.n(n);i.a},"2f21":function(t,e,a){"use strict";var n=a("79e5");t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},"34c2":function(t,e,a){"use strict";var n=a("6520"),i=a.n(n);i.a},"39c7":function(t,e,a){"use strict";var n=a("c11b"),i=a.n(n);i.a},"3cde":function(t,e,a){"use strict";var n=a("f7bc"),i=a.n(n);i.a},"3fc2":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[a("aside",{staticStyle:{"font-size":"12px"}},[t._v("\n    您可以在这里上传一些跟本次采购相关的文件。方便以后查询。\n  ")]),t._v(" "),a("h5",[t._v("附件: ")]),t._v(" "),t.completed?a("attachment",{ref:"attachment",attrs:{primary:t.primary}}):t._e(),t._v(" "),a("el-row",[a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"warning"},on:{click:t.onBack}},[t._v("\n          < 上一步\n        ")])],1)],1),t._v(" "),a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:t.onNext}},[t._v("\n          下一步 >\n        ")])],1)],1)],1)],1)},i=[],r=(a("c5f6"),a("6b1f")),s={components:{attachment:r["default"]},props:{primaryId:{type:[Number,String],default:null}},computed:{},data:function(){return{completed:!1,primary:{}}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){var t=this;this.primaryId&&this.global.axios.get("/procurementOrders/".concat(this.primaryId)).then(function(e){var a=e.data;t.primary=a||{},t.completed=!0}).catch(function(e){t.completed=!0})},onNext:function(){this.$emit("step3CBEvent",3)},onBack:function(){this.$emit("step3CBEvent",1)},reloadCBEvent:function(){this.initData()}}},o=s,l=(a("1d94"),a("2877")),c=Object(l["a"])(o,n,i,!1,null,"1c933d73",null);e["default"]=c.exports},4155:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"tag-group"},[t._l(t.primary.dataAuthories,function(e){return a("el-tag",{key:e.userId,attrs:{type:"success",closable:"","disable-transitions":!1},on:{close:function(a){return t.handleRemove(e)}}},[t._v("\n      "+t._s(e.user.name)+"\n    ")])}),t._v(" "),a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.openPersonDialog}},[t._v("+ 添加负责人")])],2),t._v(" "),a("phMembers",{ref:"members",attrs:{title:"选择负责人"},on:{saveCBEvent:t.saveCBEvent}})],1)},i=[],r=(a("5df3"),a("ac6a"),a("ed08"),a("d2d1")),s={components:{phMembers:r["a"]},props:{primary:{type:[Object],default:{}}},computed:{},data:function(){return{loading:!1,url:"/procurementOrders",relations:["creator"],filters:[{field:"relevanceId",op:"eq",data:this.primary.id}],attachments:[]}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){},openPersonDialog:function(){this.$refs.members.openDialog()},assign:function(t){var e="".concat(this.url,"/assign/").concat(this.primary.id,"/").concat(t);return this.global.axios.put(e).then(function(t){}).catch(function(t){})},saveCBEvent:function(t){var e=this;if(t&&this.primary){var a=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),n=[];t.forEach(function(t){n.push(e.assign(t))}),Promise.all(n).then(function(t){e.$refs.members.closeDialog(),e.$message.info("操作成功!"),a.close(),e.$emit("reloadCBEvent")})}},handleRemove:function(t){var e=this;t&&t.userId&&this.$confirm("确认删除吗","提示",{type:"warning",beforeClose:function(a,n,i){if("confirm"==a){var r=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s="".concat(e.url,"/cancelAssign/").concat(e.primary.id,"/").concat(t.userId);e.global.axios.put(s).then(function(t){i(),e.$message.info("操作成功!"),r.close(),e.$emit("reloadCBEvent")}).catch(function(t){r.close()}),i()}else i()}}).catch(function(t){})}}},o=s,l=(a("3cde"),a("2877")),c=Object(l["a"])(o,n,i,!1,null,"2608c800",null);e["default"]=c.exports},"50f8":function(t,e,a){},"55dd":function(t,e,a){"use strict";var n=a("5ca1"),i=a("d8e8"),r=a("4bf8"),s=a("79e5"),o=[].sort,l=[1,2,3];n(n.P+n.F*(s(function(){l.sort(void 0)})||!s(function(){l.sort(null)})||!a("2f21")(o)),"Array",{sort:function(t){return void 0===t?o.call(r(this)):o.call(r(this),i(t))}})},"642f":function(t,e,a){"use strict";var n=a("b797"),i=a.n(n);i.a},6520:function(t,e,a){},"6b1f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ph-form"},[a("el-upload",{staticClass:"upload-demo",attrs:{action:t.uploadUrl,"on-preview":t.handlePreview,"before-remove":t.beforeRemove,"on-success":t.handleSuccess,multiple:"","file-list":t.attachments}},[a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"}},[t._v("+ 添加附件")])],1)],1)},i=[],r=(a("7f7f"),a("ac6a"),a("ed08"),{components:{},props:{primary:{type:[Object],default:{}}},computed:{uploadUrl:function(){return"".concat(this.global.generateUrl(this.url),"/uploadFiles/").concat(this.primary.id,"?accessToken=").concat(this.$store.state.user.token)}},data:function(){return{url:"/attachments/procurementOrder",relations:["creator"],filters:[{field:"relevanceId",op:"eq",data:this.primary.id}],attachments:[]}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){var t=this;if(this.primary){var e=this.url;this.filters&&this.filters.length>0&&(e+="?filters="+JSON.stringify({groupOp:"AND",rules:this.filters})),this.relations&&this.relations.length>0&&(e+="&relations="+JSON.stringify(this.relations)),this.global.axios.get(e).then(function(e){var a=e.data,n=a||[];t.attachments=[],n.forEach(function(e){t.attachments.push({id:e.id,name:e.fileName,url:"".concat(t.global.generateUrl(t.url),"/view/").concat(e.id,"?accessToken=").concat(t.$store.state.user.token)})})}).catch(function(t){})}},remove:function(t){var e=this;if(this.primary){var a="".concat(this.global.generateUrl(this.url),"/").concat(t.id,"?accessToken=").concat(this.$store.state.user.token);this.global.axios.delete(a).then(function(t){e.$message.info("附件删除成功!")}).catch(function(t){})}},handleSuccess:function(){this.initData()},handlePreview:function(t){window.open(t.url,"_blank")},beforeRemove:function(t,e){var a=this;return this.$confirm("确定移除 ".concat(t.name,"？"),"提示",{beforeClose:function(e,n,i){"confirm"==e?(a.remove(t),i(!0)):i(!1)}})}}}),s=r,o=(a("642f"),a("2877")),l=Object(o["a"])(s,n,i,!1,null,"09b50b96",null);e["default"]=l.exports},"94d8":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.dialogVisible?a("el-dialog",{staticClass:"ph-dialog",attrs:{title:t.title,visible:t.dialogVisible,fullscreen:""},on:{"update:visible":function(e){t.dialogVisible=e},close:t.closeDialog}},[a("el-steps",{attrs:{active:t.stepsActive,"finish-status":"success","align-center":"",simple:""}},[a("el-step",{attrs:{title:"1.下单",icon:"el-icon-shopping-cart-full"}}),t._v(" "),a("el-step",{attrs:{title:"2.指派工作",icon:"el-icon-s-custom"}}),t._v(" "),a("el-step",{attrs:{title:"3.附件",icon:"el-icon-s-check"}}),t._v(" "),a("el-step",{attrs:{title:"4.申请预付款",icon:"el-icon-money"}})],1),t._v(" "),0==t.stepsActive&&t.primaryComplete?a("step1",{attrs:{primary:t.primary},on:{step1CBEvent:t.step1CBEvent}}):t._e(),t._v(" "),1==t.stepsActive?a("step2",{attrs:{primaryId:t.orderId},on:{step2CBEvent:t.step2CBEvent}}):t._e(),t._v(" "),2==t.stepsActive?a("step3",{attrs:{primaryId:t.orderId},on:{step3CBEvent:t.step3CBEvent}}):t._e(),t._v(" "),3==t.stepsActive?a("step4",{attrs:{primaryId:t.orderId},on:{step4CBEvent:t.step4CBEvent}}):t._e()],1):t._e()},i=[],r=(a("7f7f"),a("cebc")),s=a("2f62"),o=a("9679"),l=a("e1e7"),c=a("3fc2"),u=a("d5bc"),p={components:{step1:o["default"],step2:l["default"],step3:c["default"],step4:u["default"]},props:{},computed:Object(r["a"])({},Object(s["b"])(["device","rolePower"]),{title:function(){return"采购计划下单 ["+this.primary.name+"]"}}),data:function(){return{primaryId:null,orderId:null,primary:{},stepsActive:0,primaryComplete:!1,dialogVisible:!1}},created:function(){},mounted:function(){this.$nextTick(function(){})},methods:{initData:function(){var t=this;this.primaryId&&this.global.axios.get("/procurementPlans/".concat(this.primaryId)).then(function(e){var a=e.data;t.primary=a||{},t.dialogVisible=!0,t.primaryComplete=!0}).catch(function(t){})},openDialog:function(t){this.primaryId=t,this.initData()},closeDialog:function(){this.primary={},this.primaryId=null,this.stepsActive=0,this.dialogVisible=!1,this.primaryComplete=!1},step1CBEvent:function(t){this.$emit("createCBEvent",t),this.orderId=t.id,this.stepsActive=1},step2CBEvent:function(t){this.stepsActive=2},step3CBEvent:function(t){this.stepsActive=t},step4CBEvent:function(t){"close"==t?this.closeDialog():this.stepsActive=t}}},m=p,h=(a("f9f7"),a("2877")),d=Object(h["a"])(m,n,i,!1,null,"c55b1974",null);e["default"]=d.exports},a308:function(t,e,a){},b04e:function(t,e,a){},b797:function(t,e,a){},c11b:function(t,e,a){},d5bc:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[t.completed?a("payment",{ref:"payment",attrs:{primary:t.primary},on:{paymentCBEvent:t.paymentCBEvent}}):t._e(),t._v(" "),a("el-row",[a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"warning"},on:{click:t.onBack}},[t._v("\n          < 上一步\n        ")])],1)],1),t._v(" "),a("el-col",{attrs:{md:12}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:t.onNext}},[t._v("\n          完成\n        ")])],1)],1)],1)],1)},i=[],r=(a("c5f6"),a("f188")),s={components:{payment:r["default"]},props:{primaryId:{type:[Number,String],default:null}},computed:{},data:function(){return{completed:!1,primary:{}}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){var t=this;if(this.primaryId){var e="/procurementOrders/".concat(this.primaryId);e+="?relations="+JSON.stringify(["supplier","currency"]),this.global.axios.get(e).then(function(e){var a=e.data;t.primary=a||{},t.completed=!0}).catch(function(e){t.completed=!0})}},saveAuditCBEvent:function(t){var e=this;this.$confirm("确认将该计划提交给上级审核吗?","提示",{type:"warning",beforeClose:function(a,n,i){if("confirm"==a){var r=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s="/procurementPlans/commit/".concat(e.primaryId);e.global.axios.put(s,t).then(function(t){i(),e.$message.info("提交成功,请耐心等待上级处理! 您还可以继续创建新的采购计划! "),e.$refs.auditing.closeDialog(),r.close(),e.$emit("step4CBEvent",0)}).catch(function(t){r.close()}),i()}else i()}}).catch(function(t){})},onNext:function(){this.$emit("step4CBEvent","close")},onBack:function(){this.$emit("step4CBEvent",2)},reloadCBEvent:function(){this.initData()},paymentCBEvent:function(t){}}},o=s,l=(a("2957"),a("2877")),c=Object(l["a"])(o,n,i,!1,null,"71fdb407",null);e["default"]=c.exports},e1e7:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[a("aside",{staticStyle:{"font-size":"12px"}},[t._v("\n    为了保证本采购单的顺利执行，需要指派对应的跟单、仓管负责人，可多选。指派的负责人将会收到对应的邮件和系统消息提醒。\n  ")]),t._v(" "),a("h5",[t._v("负责人：")]),t._v(" "),t.completed?a("person",{ref:"person",attrs:{primary:t.primary},on:{reloadCBEvent:t.reloadCBEvent}}):t._e(),t._v(" "),a("el-row",[a("el-col",{attrs:{md:24}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:t.onNext}},[t._v("\n          下一步 >\n        ")])],1)],1)],1)],1)},i=[],r=(a("c5f6"),a("4155")),s={components:{person:r["default"]},props:{primaryId:{type:[Number,String],default:null}},computed:{},data:function(){return{completed:!1,primary:{}}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){var t=this;this.primaryId&&this.global.axios.get("/procurementOrders/".concat(this.primaryId)).then(function(e){var a=e.data;t.primary=a||{},t.completed=!0}).catch(function(e){t.completed=!0})},onNext:function(){this.primary&&this.primary.dataAuthories&&this.primary.dataAuthories.length>0?this.$emit("step2CBEvent",3):this.$message.error("必须选择至少一位负责人")},reloadCBEvent:function(){this.initData()}}},o=s,l=(a("34c2"),a("2877")),c=Object(l["a"])(o,n,i,!1,null,"2300cf8f",null);e["default"]=c.exports},f188:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("aside",{staticStyle:{"font-size":"12px"}},[t._v("\n    采购预付款是指与供货商约定在发货前的付款行为。例如：采购定金、采购打样费用 等等。"),a("BR"),t._v("\n    采购预付款会在之后采购单结算时，作为已付金额。"),a("BR"),t._v(" "),a("hr"),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("采购单编号："+t._s(this.primary.code)+" ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("供货商："+t._s(this.primary.supplier.name)+" ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("结算货币："+t._s(this.primary.currency.name)+" ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v(" 负责人：\n      "),t._l(this.primary.dataAuthories,function(e){return[t._v(t._s(e.user.name)+" ")]})],2),t._v(" "),a("BR"),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("订单件数："+t._s(this.orderAmount.orderQty)+" 件")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("订单箱数："+t._s(this.orderAmount.orderCartonQty)+" 箱")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("总金额：\n      "+t._s(t._f("currency")(this.orderAmount.orderAmount,this.primary.currency.symbolLeft))+"\n    ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("申请总金额：\n      "+t._s(t._f("currency")(this.paymentAmount.payableAmount,this.primary.currency.symbolLeft))+"\n    ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("已付总金额：\n      "+t._s(t._f("currency")(this.paymentAmount.paymentAmount,this.primary.currency.symbolLeft))+"\n    ")]),t._v(" "),a("hr"),t._v("\n    预付款记录:"),a("BR"),t._v(" "),a("div",{staticClass:"ph-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.financeBills,"cell-class-name":"ph-cell","header-cell-class-name":"ph-cell-header"}},[a("el-table-column",{attrs:{prop:"formatCreateTime",label:"申请日期",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"creator.name",label:"申请人",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"code",label:"付款单号",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"payableAmount",label:"申请金额",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("currency")(e.row.payableAmount?e.row.payableAmount:0,t.primary.currency.symbolLeft))+"\n          ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"付款金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("currency")(e.row.paymentAmount?e.row.paymentAmount:0,t.primary.currency.symbolLeft))+"\n          ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small",type:0===e.row.status?"info":1===e.row.status?"warning":"success","disable-transitions":""}},[t._v(" "+t._s(0===e.row.status?"已拒绝":1===e.row.status?"未付款":"已付款")+"\n            ")])]}}])})],1)],1)],1),t._v(" "),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"paymentFrom",attrs:{rules:t.rules,model:t.paymentObjet,"status-icon":"",inline:"","label-position":"right","label-width":"120px"}},[a("fieldset",{staticClass:"panel-heading",staticStyle:{"margin-top":"15px"}},[a("legend",{staticClass:"panel-title"},[t._v("申请付款\n        "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"right"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n            申请付款\n          ")]),t._v(" "),a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1),t._v(" "),a("el-row",[a("el-col",{attrs:{md:8}},[a("el-form-item",{attrs:{label:"申请付款金额",prop:"payableAmount"}},[a("el-input-number",{staticStyle:{width:"155px"},attrs:{precision:2,min:0,step:1,max:1e7,label:"申请付款金额"},on:{change:t.onPayableAmountChange},model:{value:t.paymentObjet.payableAmount,callback:function(e){t.$set(t.paymentObjet,"payableAmount",e)},expression:"paymentObjet.payableAmount"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"申请付款金额",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),a("el-col",{attrs:{md:8}},[a("el-form-item",{attrs:{label:"最晚付款时间",prop:"prepayTime"}},[a("el-date-picker",{staticStyle:{width:"155px"},attrs:{type:"date",placeholder:"选择日期"},model:{value:t.paymentObjet.prepayTime,callback:function(e){t.$set(t.paymentObjet,"prepayTime",e)},expression:"paymentObjet.prepayTime"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"财务必须在该日期前付款",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),a("el-col",{attrs:{md:8}},[a("el-form-item",{attrs:{label:"金额占比 %",prop:"ratio"}},[a("el-input-number",{staticStyle:{width:"155px"},attrs:{precision:2,min:0,step:1,max:100,label:"金额占比"},on:{change:t.onRatioChange},model:{value:t.paymentObjet.ratio,callback:function(e){t.$set(t.paymentObjet,"ratio",e)},expression:"paymentObjet.ratio"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"本次付款占总额的百分比。通过设置占比可以自动计算金额。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{md:24}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:t.onPayment}},[t._v("\n              申请\n            ")])],1)],1)],1)],1)])],1)},i=[],r=a("ed08"),s=a("d2d1"),o={components:{phMembers:s["a"]},props:{primary:{type:[Object],default:{}}},computed:{},filters:{currency:r["b"]},data:function(){return{loading:!1,url:"/financeBills",relations:["creator"],filters:[{field:"relevanceCode",op:"eq",data:this.primary.code}],orderAmount:{},paymentAmount:{},financeBills:[],paymentObjet:{payableAmount:null,prepayTime:null,ratio:null},rules:{payableAmount:[{required:!0,message:"必须输入",trigger:"blur"}],prepayTime:[{required:!0,message:"必须输入",trigger:"blur"}]}}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){var t=this;this.global.axios.get("/procurementOrders/amount/".concat(this.primary.id)).then(function(e){var a=e.data;t.orderAmount=a||{}}).catch(function(t){}),this.global.axios.get("/financeBills/paymentAmount/".concat(this.primary.code)).then(function(e){var a=e.data;t.paymentAmount=a||{}}).catch(function(t){});var e=this.url;this.filters&&this.filters.length>0&&(e+="?filters="+JSON.stringify({groupOp:"AND",rules:this.filters})),this.relations&&this.relations.length>0&&(e+="&relations="+JSON.stringify(this.relations)),e+="&sort=id&dir=desc",this.global.axios.get(e).then(function(e){var a=e.data;t.financeBills=a||{}}).catch(function(t){})},onPayableAmountChange:function(t){this.paymentObjet.ratio=(t/this.orderAmount.orderAmount*100).toFixed(2),this.$forceUpdate()},onRatioChange:function(t){this.paymentObjet.payableAmount=(t/100*this.orderAmount.orderAmount).toFixed(2),this.$forceUpdate()},onPayment:function(){var t=this;this.$refs.paymentFrom.validate(function(e){e&&t.$confirm("您确定提交本次付款申请吗？","提示",{type:"warning",beforeClose:function(e,a,n){"confirm"==e?(n(),t.paymentObject()):n()}}).catch(function(t){})})},paymentObject:function(){var t=this,e=JSON.parse(JSON.stringify(this.paymentObjet));this.global.axios.post("/procurementOrders/applyPayment/".concat(this.primary.id),e).then(function(e){var a=e.data;t.loading=!1,t.confirmLoading=!1,t.paymentObjet.payableAmount=null,t.paymentObjet.prepayTime=null,t.paymentObjet.ratio=null,t.$refs.paymentFrom.resetFields(),t.$message.success("操作成功"),t.initData(),t.$emit("modifyCBEvent",a)}).catch(function(e){console.log(e),t.loading=!1,t.confirmLoading=!1})}}},l=o,c=(a("2e49"),a("2877")),u=Object(c["a"])(l,n,i,!1,null,"efe66cb6",null);e["default"]=u.exports},f7bc:function(t,e,a){},f9f7:function(t,e,a){"use strict";var n=a("a308"),i=a.n(n);i.a}}]);