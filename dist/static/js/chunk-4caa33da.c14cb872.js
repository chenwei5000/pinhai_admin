(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4caa33da"],{"2e49":function(t,e,a){"use strict";var n=a("50f8"),i=a.n(n);i.a},"50f8":function(t,e,a){},f188:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("aside",{staticStyle:{"font-size":"12px"}},[t._v("\n    采购预付款是指与供货商约定在发货前的付款行为。例如：采购定金、采购打样费用 等等。"),a("BR"),t._v("\n    采购预付款会在之后采购单结算时，作为已付金额。"),a("BR"),t._v(" "),a("hr"),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("采购单编号："+t._s(this.primary.code)+" ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("供货商："+t._s(this.primary.supplier.name)+" ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("结算货币："+t._s(this.primary.currency.name)+" ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v(" 负责人：\n      "),t._l(this.primary.dataAuthories,function(e){return[t._v(t._s(e.user.name)+" ")]})],2),t._v(" "),a("BR"),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("订单件数："+t._s(this.orderAmount.orderQty)+" 件")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("订单箱数："+t._s(this.orderAmount.orderCartonQty)+" 箱")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("总金额：\n      "+t._s(t._f("currency")(this.orderAmount.orderAmount,this.primary.currency.symbolLeft))+"\n    ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("申请总金额：\n      "+t._s(t._f("currency")(this.paymentAmount.payableAmount,this.primary.currency.symbolLeft))+"\n    ")]),t._v(" "),a("span",{staticStyle:{"margin-right":"30px"}},[t._v("已付总金额：\n      "+t._s(t._f("currency")(this.paymentAmount.paymentAmount,this.primary.currency.symbolLeft))+"\n    ")]),t._v(" "),a("hr"),t._v("\n    预付款记录:"),a("BR"),t._v(" "),a("div",{staticClass:"ph-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.financeBills,"cell-class-name":"ph-cell","header-cell-class-name":"ph-cell-header"}},[a("el-table-column",{attrs:{prop:"formatCreateTime",label:"申请日期",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"creator.name",label:"申请人",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"code",label:"付款单号",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"payableAmount",label:"申请金额",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("currency")(e.row.payableAmount?e.row.payableAmount:0,t.primary.currency.symbolLeft))+"\n          ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"付款金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("currency")(e.row.paymentAmount?e.row.paymentAmount:0,t.primary.currency.symbolLeft))+"\n          ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small",type:0===e.row.status?"info":1===e.row.status?"warning":"success","disable-transitions":""}},[t._v(" "+t._s(0===e.row.status?"已拒绝":1===e.row.status?"未付款":"已付款")+"\n            ")])]}}])})],1)],1)],1),t._v(" "),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"paymentFrom",attrs:{rules:t.rules,model:t.paymentObjet,"status-icon":"",inline:"","label-position":"right","label-width":"120px"}},[a("fieldset",{staticClass:"panel-heading",staticStyle:{"margin-top":"15px"}},[a("legend",{staticClass:"panel-title"},[t._v("申请付款\n        "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"right"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n            申请付款\n          ")]),t._v(" "),a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1),t._v(" "),a("el-row",[a("el-col",{attrs:{md:8}},[a("el-form-item",{attrs:{label:"申请付款金额",prop:"payableAmount"}},[a("el-input-number",{staticStyle:{width:"155px"},attrs:{precision:2,min:0,step:1,max:1e7,label:"申请付款金额"},on:{change:t.onPayableAmountChange},model:{value:t.paymentObjet.payableAmount,callback:function(e){t.$set(t.paymentObjet,"payableAmount",e)},expression:"paymentObjet.payableAmount"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"申请付款金额",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),a("el-col",{attrs:{md:8}},[a("el-form-item",{attrs:{label:"最晚付款时间",prop:"prepayTime"}},[a("el-date-picker",{staticStyle:{width:"155px"},attrs:{type:"date",placeholder:"选择日期"},model:{value:t.paymentObjet.prepayTime,callback:function(e){t.$set(t.paymentObjet,"prepayTime",e)},expression:"paymentObjet.prepayTime"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"财务必须在该日期前付款",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1),t._v(" "),a("el-col",{attrs:{md:8}},[a("el-form-item",{attrs:{label:"金额占比 %",prop:"ratio"}},[a("el-input-number",{staticStyle:{width:"155px"},attrs:{precision:2,min:0,step:1,max:100,label:"金额占比"},on:{change:t.onRatioChange},model:{value:t.paymentObjet.ratio,callback:function(e){t.$set(t.paymentObjet,"ratio",e)},expression:"paymentObjet.ratio"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"本次付款占总额的百分比。通过设置占比可以自动计算金额。",placement:"right"}},[a("i",{staticClass:"el-icon-question"},[t._v(" ")])])],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{md:24}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{staticStyle:{"margin-top":"40px"},attrs:{type:"primary"},on:{click:t.onPayment}},[t._v("\n              申请\n            ")])],1)],1)],1)],1)])],1)},i=[],r=a("ed08"),s=a("d2d1"),l={components:{phMembers:s["a"]},props:{primary:{type:[Object],default:{}}},computed:{},filters:{currency:r["b"]},data:function(){return{loading:!1,url:"/financeBills",relations:["creator"],filters:[{field:"relevanceCode",op:"eq",data:this.primary.code}],orderAmount:{},paymentAmount:{},financeBills:[],paymentObjet:{payableAmount:null,prepayTime:null,ratio:null},rules:{payableAmount:[{required:!0,message:"必须输入",trigger:"blur"}],prepayTime:[{required:!0,message:"必须输入",trigger:"blur"}]}}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.initData()})},methods:{initData:function(){var t=this;this.global.axios.get("/procurementOrders/amount/".concat(this.primary.id)).then(function(e){var a=e.data;t.orderAmount=a||{}}).catch(function(t){}),this.global.axios.get("/financeBills/paymentAmount/".concat(this.primary.code)).then(function(e){var a=e.data;t.paymentAmount=a||{}}).catch(function(t){});var e=this.url;this.filters&&this.filters.length>0&&(e+="?filters="+JSON.stringify({groupOp:"AND",rules:this.filters})),this.relations&&this.relations.length>0&&(e+="&relations="+JSON.stringify(this.relations)),e+="&sort=id&dir=desc",this.global.axios.get(e).then(function(e){var a=e.data;t.financeBills=a||{}}).catch(function(t){})},onPayableAmountChange:function(t){this.paymentObjet.ratio=(t/this.orderAmount.orderAmount*100).toFixed(2),this.$forceUpdate()},onRatioChange:function(t){this.paymentObjet.payableAmount=(t/100*this.orderAmount.orderAmount).toFixed(2),this.$forceUpdate()},onPayment:function(){var t=this;this.$refs.paymentFrom.validate(function(e){e&&t.$confirm("您确定提交本次付款申请吗？","提示",{type:"warning",beforeClose:function(e,a,n){"confirm"==e?(n(),t.paymentObject()):n()}}).catch(function(t){})})},paymentObject:function(){var t=this,e=JSON.parse(JSON.stringify(this.paymentObjet));this.global.axios.post("/procurementOrders/applyPayment/".concat(this.primary.id),e).then(function(e){var a=e.data;t.loading=!1,t.confirmLoading=!1,t.paymentObjet.payableAmount=null,t.paymentObjet.prepayTime=null,t.paymentObjet.ratio=null,t.$refs.paymentFrom.resetFields(),t.$message.success("操作成功"),t.initData(),t.$emit("modifyCBEvent",a)}).catch(function(e){console.log(e),t.loading=!1,t.confirmLoading=!1})}}},o=l,c=(a("2e49"),a("2877")),p=Object(c["a"])(o,n,i,!1,null,"efe66cb6",null);e["default"]=p.exports}}]);